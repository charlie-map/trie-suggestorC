<html>
	<head>
		<link rel="shortcut icon" type="image/png" href="https://i.pinimg.com/originals/19/95/0c/19950c83ac1f0a4ca85819338e5f2a03.png">

		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300&display=swap" rel="stylesheet">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	</head>
	<body>
		<style>
			:root {
				--duration: 3.2s;
				--stagger: .65s;
				--easing: cubic-bezier(.36,.07,.25,1);
				--offscreen: 130vmax;
				/*cubic-bezier(.5, 0, .4, 1);*/
				--color-bg: #0d7377;
				--color-blue: #d44f0e;
				--color-shadow: #211842;
				--color-bright-blue: #14ffec;
				--color-medium-blue: #11bdaf;
			}

			* {
				font-family: 'Montserrat', sans-serif;
				margin: 0;
				padding: 0;

				transform-style: preserve-3d;
			}

			body {
				height: 100%;
				display: flex;
				flex-direction: column;
				align-items: center;
				justify-content: center;
				background: var(--color-bg);
			}

			#typetracker {
				background: #fff;
				width: 80%;
				height: 100px;
				border: none;
				border-radius: 10px;

				display: flex;
				align-items: center;
				justify-content: center;

				box-shadow: rgba(0, 0, 0, 0.3) 0px 19px 38px, rgba(0, 0, 0, 0.22) 0px 15px 12px;
			}

			#timebar {
				content: '';
				display: block;
				position: absolute;
				top: 0;
				left: 0;

				border-top-left-radius: 25px;
				border-top-right-radius: 25px;

				height: 7px;
				background: var(--color-blue);
			}

			#timer {
				content: '';
				display: block;
				position: absolute;
				top: 7px;
				left: 4px;

				width: 115px;
				height: 40px;

				font-size: 20px;
			}

			#inputbox {
				width: 0;
				border: none;
				outline: none;
			}

			#blinker {
				width: 2px;
				height: 50px;
				background: #fff;
			}

			#blinker.selected {
				animation:
					typeblink 1.2s step-end infinite;
			}

			#blinker.typing {
				background: #000;
			}

			@keyframes typeblink {
				from, to { background: #000; }
				50% { background: #fff; }
			}

			.type {
				width: 50%;

				overflow-x: hidden;

				display: flex;
				align-items: center;
			}

			.type span {
				font-size: 35px;
			}

			.type span.is_current {
				color: var(--color-medium-blue) !important;
			}

			.type span.is_wrong {
				color: grey;
				text-decoration: line-through;
			}

			.pre.type span {
				text-align: left;
				padding-right: 8px;
			}

			.post {
				display: flex;
				justify-content: flex-end;
			}

			.post.type span {
				text-align: right;
				padding-left: 8px;
				color: grey;
			}
		</style>

		<div id="typetracker">
			<div id="timebar"></div>
			<div id="timer"></div>
			<div class="post type">
				<span class="is_current"></span>
			</div>
			<input id="inputbox"/>
			<div id="blinker"></div>
			<div class="pre type">
				<span full_word="type">type</span>
				<span full_word="test">test</span>
				<span full_word="is">is</span>
				<span full_word="this">this</span>
				<span full_word="working">working</span>
			</div>
		</div>

		<script>
			$("#timebar").css("width", "100%");
			$(".type span").on("click", blinkerselect);

			let current_timebar_radius = 25;
			let timer = 0;

			function changetimebar() {
				$("#timebar").css("width", ((60 - timer) / 60) * 100 + "%");

				current_timebar_radius -= current_timebar_radius < 0 ? 0 : 3;

				$("#timebar").css("border-top-right-radius", current_timebar_radius + "px");

				timer += 0.1;

				let calc_seconds = 60 - Math.round(timer);

				$("#timer").html((calc_seconds < 10 ? "0" : "") + calc_seconds + " second" + (calc_seconds == 1 ? "" : "s"));

				if (timer < 60)
					setTimeout(changetimebar, 100);
				else {
					$("#timerbar").animate({
						width: "100%",
					}, 1000, function() {
						$("#timerbar").css("border-top-right-radius", "25px");
					});
				}
			}

			function blinkerselect() {
				$("#inputbox").select();
				$("#blinker").addClass("selected");
			}

			blinkerselect();

			$("#inputbox").focusout(function() {
				$("#blinker").removeClass("selected");
			});

			function turnon() {
				$("#blinker").removeClass("typing");
				$("#blinker").addClass("selected");
			}

			let current_word_length = 0;
			let stall_out = 0;

			$("#inputbox").keyup(function() {
				if (timer == 0)
					changetimebar(); // start timer

				if (stall_out) {
					stall_out--;
					return;
				}

				// remove typing animation
				$("#blinker").addClass("typing");
				$("#blinker").removeClass("selected");
				setTimeout(turnon, 100);

				let current_post_element = $(".post.type span:last-child");
				let current_pre_element = $(".pre.type span:first-child");

				let current_post_value = $(current_post_element).html();
				let current_post_value_length = current_post_value.length;
				let current_pre_value = $(current_pre_element).html();
				let current_pre_value_length = current_pre_value.length;

				let full_pre_word = $(current_pre_element).attr("full_word");

				let current_char = $(this).val();
				$(this).val("");

				if (current_char.length == 0) { // possible deletion
					// if current_word_length is 0, ignore this
					if (current_word_length == 0)
						return;

					if (current_post_value[current_post_value_length - 1] == full_pre_word[current_post_value_length - 1]) {
						// pass value over

						$(current_pre_element).html(current_post_value[current_post_value_length - 1] + current_pre_value);
					
						current_word_length--;
					}

					current_post_value = current_post_value.slice(0, current_post_value_length - 1);
					current_post_value_length--;

					// check is_wrong
					if (current_post_value == full_pre_word.slice(0, current_post_value_length))
						$(current_post_element).removeClass("is_wrong");

					// update post element
					$(current_post_element).html(current_post_value);

					return;
				}

				stall_out = current_char.length - 1;

				console.log(current_char);

				// loop over incoming chars
				for (let loop_char = 0; loop_char < current_char.length; loop_char++) {

					if (current_char[loop_char] == "\n")
						continue;

					if (current_char[loop_char] == " ") {
						// check if there is any characters current
						if (current_word_length) {
							$(current_pre_element).html(current_pre_value);
							$(current_post_element).html(current_post_value);

							current_post_value = "";
							current_post_value_length = 0;

							$(current_post_element).removeClass("is_current");
							$(".post.type").append("<span class='is_current'></span>");

							current_post_element = $(".post.type span:last-child");

							$(current_post_element).on("click", blinkerselect);
							$(current_pre_element).remove();

							// update pre element if there are more characters
							if (loop_char < current_char.length - 1) {
								current_pre_element = $(".pre.type span:first-child");

								current_pre_value = $(current_pre_element).html();
							}
						}

						current_word_length = 0;
					} else {
						console.log(current_char, current_pre_value);
						// if the current_char is different than current_pre_value
						// something is wrong
						if (current_char[loop_char] == current_pre_value[0])
							current_pre_value = current_pre_value.slice(1);
						else
							$(current_post_element).addClass("is_wrong");

						current_post_value += current_char[loop_char];

						current_word_length++;
					}
				}

				$(current_pre_element).html(current_pre_value);
				$(current_post_element).html(current_post_value);
			});
		</script>
	</body>
</html>