<html>
	<head>
		<link rel="shortcut icon" type="image/png" href="https://i.pinimg.com/originals/19/95/0c/19950c83ac1f0a4ca85819338e5f2a03.png">

		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300&display=swap" rel="stylesheet">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	</head>
	<body>
		<style>
			:root {
				--duration: 3.2s;
				--stagger: .65s;
				--easing: cubic-bezier(.36,.07,.25,1);
				--offscreen: 130vmax;
				/*cubic-bezier(.5, 0, .4, 1);*/
				--color-bg: #0d7377;
				--color-blue: #d44f0e;
				--color-shadow: #211842;
				--color-bright-blue: #14ffec;
				--color-medium-blue: #11bdaf;
			}

			* {
				font-family: 'Montserrat', sans-serif;
				margin: 0;
				padding: 0;

				transform-style: preserve-3d;
			}

			body {
				height: 100%;
				display: flex;
				flex-direction: column;
				align-items: center;
				justify-content: center;
				background: var(--color-bg);
			}

			#typetracker {
				background: #fff;
				width: 80%;
				height: 100px;
				border: none;
				border-radius: 10px;

				display: flex;
				align-items: center;
				justify-content: center;

				box-shadow: rgba(0, 0, 0, 0.3) 0px 19px 38px, rgba(0, 0, 0, 0.22) 0px 15px 12px;
			}

			#timebar {
				content: '';
				display: block;
				position: absolute;
				top: 0;
				left: 0;

				border-top-left-radius: 25px;
				border-top-right-radius: 25px;

				height: 7px;
				background: var(--color-blue);
			}

			#timer {
				content: '';
				display: block;
				position: absolute;
				top: 7px;
				left: 4px;

				width: 115px;
				height: 40px;

				font-size: 20px;
			}

			#inputbox {
				width: 0;
				border: none;
				outline: none;
			}

			#blinker {
				width: 2px;
				height: 50px;
				background: #fff;
			}

			#blinker.selected {
				animation:
					typeblink 1.2s step-end infinite;
			}

			#blinker.typing {
				background: #000;
			}

			@keyframes typeblink {
				from, to { background: #000; }
				50% { background: #fff; }
			}

			.type {
				width: 50%;

				overflow-x: hidden;

				display: flex;
				align-items: center;
			}

			.type span {
				font-size: 35px;
			}

			.type span.is_current {
				color: var(--color-medium-blue) !important;
			}

			.type span.is_wrong {
				color: grey;
				text-decoration: line-through;
			}

			.pre.type span {
				text-align: left;
				padding-right: 8px;
			}

			.post {
				display: flex;
				justify-content: flex-end;
			}

			.post.type span {
				text-align: right;
				padding-left: 8px;
				color: grey;
			}
		</style>

		<div id="typetracker">
			<div id="timebar"></div>
			<div id="timer"></div>
			<div class="post type">
				<span class="is_current"></span>
			</div>
			<input id="inputbox"/>
			<div id="blinker"></div>
			<div class="pre type">
				<span full_word="type">type</span>
				<span full_word="test">test</span>
				<span full_word="is">is</span>
				<span full_word="this">this</span>
				<span full_word="working">working</span>
			</div>
		</div>

		<script>
			$("#timebar").css("width", "100%");
			$(".type span").on("click", blinkerselect);

			let current_timebar_radius = 25;
			let timer = 0;

			function changetimebar() {
				$("#timebar").css("width", ((60 - timer) / 60) * 100 + "%");

				current_timebar_radius -= current_timebar_radius < 0 ? 0 : 3;

				$("#timebar").css("border-top-right-radius", current_timebar_radius + "px");

				timer += 0.1;

				let calc_seconds = 60 - Math.round(timer);

				$("#timer").html((calc_seconds < 10 ? "0" : "") + calc_seconds + " second" + (calc_seconds == 1 ? "" : "s"));

				if (timer < 60)
					setTimeout(changetimebar, 100);
				else {
					$("#timerbar").animate({
						width: "100%",
					}, 1000, function() {
						$("#timerbar").css("border-top-right-radius", "25px");
					});
				}
			}

			function blinkerselect() {
				$("#inputbox").select();
				$("#blinker").addClass("selected");
			}

			blinkerselect();

			$("#inputbox").focusout(function() {
				$("#blinker").removeClass("selected");
			});

			function turnon() {
				$("#blinker").removeClass("typing");
				$("#blinker").addClass("selected");
			}

			let current_input_length = 0;

			$("#inputbox").keyup(function() {
				if (timer == 0)
					changetimebar(); // start timer

				// remove typing animation
				$("#blinker").addClass("typing");
				$("#blinker").removeClass("selected");
				setTimeout(turnon, 100);

				let current_char = $(this).val();
				$(this).val("");

				console.log(current_char);

				// otherwise update most recent span in post type
				let current_pre_value = $(".pre.type span:first-child").html();
				let current_post_value = $(".post.type span:last-child").html();

				if (current_char.length == 0 && current_input_length >= 0) { // deletion
					// check full_word
					let full_word = $(".pre.type span:first-child").attr("full_word");

					if (!full_word)
						return;

					if (current_post_value[current_post_value.length - 1] == full_word[current_post_value.length - 1]) {
						// pass value over
						$(".pre.type span:first-child").html(current_post_value[current_post_value.length - 1] + current_pre_value);
					}

					current_post_value = current_post_value.slice(0, current_post_value.length - 1);

					// check is_wrong
					if (current_post_value == full_word.slice(0, current_post_value.length))
						$(".post.type span:last-child").removeClass("is_wrong");

					$(".post.type span:last-child").html(current_post_value);

					current_input_length--;

					return;
				}

				for (let check_chars = 0; check_chars < current_char.length; check_chars++) {

					if (current_char[check_chars] == "\n")
						continue;

					console.log("check chars:", current_char[check_chars]);

					// space means new word
					if (current_char[check_chars] == " ") {
						// update post type IF current_char has text in it
						if (current_post_value.length) {
							$(".post.type span:last-child").removeClass("is_current");
							$(".post.type").append("<span class='is_current'></span>");

							$(".post.type span:last-child").on("click", blinkerselect);
							$(".pre.type span:first-child").remove();
						}

						current_input_length = 0;
					} else {

						// if the current_char is different than current_pre_value
						// something is wrong
						if (current_pre_value && current_char[check_chars] == current_pre_value[0]) {
							$(".post.type span:last-child").html(current_post_value + current_char[check_chars]);
							$(".pre.type span:first-child").html(current_pre_value.slice(1));
						} else {
							$(".post.type span:last-child").addClass("is_wrong");
							$(".post.type span:last-child").html(current_post_value + current_char[check_chars]);
						}

						current_input_length++;
					}
				}
			});
		</script>
	</body>
</html>